!function(){"use strict";angular.module("musApp",["ngRoute","btford.socket-io","ui.bootstrap"])}(),function(){"use strict";angular.module("musApp").controller("chatController",["$scope","$element","$filter","musSocketService",function(e,o,r,n){e.chatLog=[],e.message="",e.$on("socket:room-join-success",function(o,r){var n=JSON.parse(r).room.name,t=JSON.parse(r).playerName;e.updateLog(n,"¡Bienvenido a "+n+" "+t+"!")}),e.$on("socket:new-message",function(o,r){e.updateLog(JSON.parse(r).playerName,JSON.parse(r).message)}),e.$on("socket:new-player-joined",function(o,r){var n=JSON.parse(r).room.name,t=JSON.parse(r).playerName;e.updateLog(n,t+" se ha unido a "+n+".")}),e.$on("socket:player-left",function(o,r){var n=JSON.parse(r).room.name,t=JSON.parse(r).playerName;e.updateLog(n,t+" ha abandonado "+n+".")}),e.$watchCollection("chatLog",function(){e.$evalAsync(function(){var e=o[0].getElementsByClassName("chat__panel")[0];e.scrollTop=e.scrollHeight})}),e.updateLog=function(o,r){e.chatLog.push({playerName:o,time:new Date,content:r})},e.sendMessage=function(){n.emit("message",e.message),e.message=""}}])}(),function(){"use strict";angular.module("musApp").controller("mainCtrl",["$scope","$location","$modal","musSocketService",function(e,o,r,n){e.musModel={},n.emit("mus-info"),e.createRoom=function(){var e=r.open({animation:!0,templateUrl:"src/views/modals/createRoomModal.html",controller:"createRoomModalCtrl",size:"sm"});e.result.then(function(e){n.emit("create-room",JSON.stringify({roomName:e.roomName,playerName:e.playerName}))})},e.$on("socket:room-creation-success",function(e,r){o.url("/room/"+r)}),e.$on("socket:update-mus",function(o,r){e.updateModel(JSON.parse(r))}),e.updateModel=function(o){e.musModel=o},e.joinRoom=function(e){o.url("/room/"+e)},e.getFullRooms=function(){var o=[];if("undefined"!=typeof e.musModel.roomsModel)for(var r in e.musModel.roomsModel.rooms)e.musModel.roomsModel.rooms[r].players.length===e.musModel.roomsModel.rooms[r].maxPlayers&&o.push(e.musModel.roomsModel.rooms[r]);return o},e.getNotFullRooms=function(){var o=[];if("undefined"!=typeof e.musModel.roomsModel)for(var r in e.musModel.roomsModel.rooms)e.musModel.roomsModel.rooms[r].players.length<e.musModel.roomsModel.rooms[r].maxPlayers&&o.push(e.musModel.roomsModel.rooms[r]);return o}}])}(),function(){"use strict";angular.module("musApp").controller("roomCtrl",["$scope","$location","$routeParams","$modal","musSocketService",function(e,o,r,n,t){e.playerName="",e.room={},t.emit("room-info",r.roomId),e.$on("socket:room-info-success",function(r,a){if(e.updateRoom(JSON.parse(a).room),e.playerName=JSON.parse(a).playerName,e.isRoomFull())n.open({animation:!0,templateUrl:"src/views/modals/infoModal.html",controller:"infoModalCtrl",size:"sm",resolve:{infoData:function(){return{title:"Mesa llena",message:"Lo sentimos pero esta mesa está llena. Prueba en otra!"}}}}),o.url("/");else if(!e.isUserInRoomAlready()){var s=n.open({animation:!0,templateUrl:"src/views/modals/joinRoomModal.html",controller:"joinRoomModalCtrl",size:"sm"});s.result.then(function(o){e.playerName=o.playerName,t.emit("join-room",e.playerName,e.room.id)},function(){o.url("/")})}}),e.$on("socket:room-info-failure",function(){n.open({animation:!0,templateUrl:"src/views/modals/infoModal.html",controller:"infoModalCtrl",size:"sm",resolve:{infoData:function(){return{title:"Mesa no válida",message:"La mesa a la que estas intentando acceder no existe. Prueba en otra!"}}}}),o.url("/")}),e.$on("socket:room-join-failure",function(){n.open({animation:!0,templateUrl:"src/views/modals/infoModal.html",controller:"infoModalCtrl",size:"sm",resolve:{infoData:function(){return{title:"Error al unirse a la mesa",message:"Lo sentimos. Hubo un error al acceder a la mesa. Pruebe en otra!"}}}}),o.url("/")}),e.$on("socket:leave-room-success",function(){o.url("/")}),e.$on("socket:update-room",function(o,r){e.$apply(function(){e.updateRoom(JSON.parse(r))})}),e.updateRoom=function(o){e.room=o},e.isRoomFull=function(){return e.room.maxPlayers===e.room.players.length},e.isUserInRoomAlready=function(){return e.room.players.indexOf(e.playerName)>-1},e.leaveRoom=function(){t.emit("leave-room",e.room.id)}}])}(),function(){"use strict";angular.module("musApp").directive("chat",function(){return{restrict:"E",replace:!0,templateUrl:"src/views/templates/chat.html",scope:{playerName:"=",players:"="},controller:"chatController"}})}(),function(){"use strict";angular.module("musApp").directive("game",function(){return{restrict:"E",replace:!0,templateUrl:"src/views/templates/game.html"}})}(),function(){"use strict";angular.module("musApp").directive("message",function(){return{restrict:"E",replace:!0,templateUrl:"src/views/templates/message.html",scope:{playerName:"=",message:"=",players:"="},controller:["$scope",function(e){e.getPlayerIndexClass=function(){return"message__player--"+e.players.indexOf(e.message.playerName)}}]}})}(),function(){"use strict";angular.module("musApp").filter("formatMessage",function(){return function(e,o){return(new Date).toLocaleTimeString()+" - "+e+": "+o+"\n"}})}(),function(){"use strict";angular.module("musApp").filter("toArray",function(){return function(e,o){for(var r in o)e.push(o[r]);return e}})}(),function(){"use strict";angular.module("musApp").config(["$routeProvider",function(e){e.when("/",{templateUrl:"src/views/main.html",controller:"mainCtrl"}).when("/room/:roomId",{templateUrl:"src/views/room.html",controller:"roomCtrl"}).otherwise({redirectTo:"/"})}])}(),function(){"use strict";angular.module("musApp").factory("musSocketService",function(e){var o=e();return o.forward("update-mus"),o.forward("update-room"),o.forward("room-creation-success"),o.forward("room-info-success"),o.forward("room-info-failure"),o.forward("room-join-failure"),o.forward("room-join-success"),o.forward("new-player-joined"),o.forward("leave-room-success"),o.forward("player-left"),o.forward("new-message"),o})}(),function(){"use strict";angular.module("musApp").controller("createRoomModalCtrl",["$scope","$modalInstance",function(e,o){e.roomName="",e.playerName="",e.nothingSubmittedYet=!0,e.roomNameIsMissing=function(){return!e.nothingSubmittedYet&&("undefined"==typeof e.roomName||""===e.roomName)},e.playerNameIsMissing=function(){return!e.nothingSubmittedYet&&("undefined"==typeof e.playerName||""===e.playerName)},e.ok=function(){e.nothingSubmittedYet=!1,e.roomNameIsMissing()||e.playerNameIsMissing()||o.close({roomName:e.roomName,playerName:e.playerName})},e.cancel=function(){o.dismiss("cancel")}}])}(),function(){"use strict";angular.module("musApp").controller("infoModalCtrl",["$scope","$modalInstance","infoData",function(e,o,r){e.infoData=r,e.ok=function(){o.close()}}])}(),function(){"use strict";angular.module("musApp").controller("joinRoomModalCtrl",["$scope","$modalInstance",function(e,o){e.playerName="",e.nothingSubmittedYet=!0,e.playerNameIsMissing=function(){return!e.nothingSubmittedYet&&("undefined"==typeof e.playerName||""===e.playerName)},e.ok=function(){e.nothingSubmittedYet=!1,e.playerNameIsMissing()||o.close({playerName:e.playerName})},e.cancel=function(){o.dismiss("cancel")}}])}();