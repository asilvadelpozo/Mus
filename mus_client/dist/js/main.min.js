!function(){"use strict";angular.module("musApp",["ngRoute","ngAnimate","btford.socket-io","ui.bootstrap"])}(),function(){"use strict";angular.module("musApp").controller("chatCtrl",["$scope","$element","$filter","musSocketService",function(e,r,o,a){e.chatLog=[],e.message="",e.$on("socket:room-join-success",function(r,o){var a=JSON.parse(o).room.name,t=JSON.parse(o).playerName;e.updateLog(a,"¡Bienvenido a "+a+" "+t+"!")}),e.$on("socket:new-message",function(r,o){e.updateLog(JSON.parse(o).playerName,JSON.parse(o).message)}),e.$on("socket:new-player-joined",function(r,o){var a=JSON.parse(o).room.name,t=JSON.parse(o).playerName;e.updateLog(a,t+" se ha unido a "+a+".")}),e.$on("socket:player-left",function(r,o){var a=JSON.parse(o).room.name,t=JSON.parse(o).playerName;e.updateLog(a,t+" ha abandonado "+a+".")}),e.$watchCollection("chatLog",function(){e.$evalAsync(function(){var e=r[0].getElementsByClassName("chat__panel")[0];e.scrollTop=e.scrollHeight})}),e.updateLog=function(r,o){e.chatLog.push({playerName:r,time:new Date,content:o})},e.sendMessage=function(){a.emit("message",e.message),e.message=""}}])}(),function(){"use strict";angular.module("musApp").controller("gameActionsCtrl",["$scope","musSocketService",function(e,r){console.log(r),e.players=[],e.playerSelected="",e.show=function(){var r=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]];e.game.players.forEach(function(o,a){e.playerName!==o?r[a]=[4*a+1,4*a+2,4*a+3,4*a+4]:r[a]=e.game.cards[a]}),e.game.cards=r},e.discard=function(){var r=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]];e.game.players.forEach(function(o,a){e.playerSelected===o?r[a]=[-1,-1,-1,-1]:r[a]=e.game.cards[a]}),e.game.cards=r},e.updateSelectedPlayer=function(r){e.playerSelected=r},e.$on("socket:game-started",function(){e.game.currentStatus="game-started",e.players=[],e.game.players.forEach(function(r){e.players.push(r)}),e.playerSelected=e.players[0]}),e.$on("socket:player-left",function(){e.game.currentStatus="waiting"}),e.$on("socket:hand-started",function(r,o){var a=JSON.parse(o),t=a.playerCards,n=a.hand,s=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]];e.game.hand=n,e.game.currentStatus="hand-started",e.game.players.forEach(function(r,o){e.playerName===r&&(s[o]=t)}),e.game.cards=s}),e.isRoomFull=function(){return e.game.players.filter(function(e){return null!==e}).length===e.game.maxPlayers}}])}(),function(){"use strict";angular.module("musApp").controller("mainCtrl",["$scope","$location","$modal","musSocketService",function(e,r,o,a){e.musModel={},a.emit("mus-info"),e.createRoom=function(){var e=o.open({animation:!0,templateUrl:"src/views/modals/createRoomModal.html",controller:"createRoomModalCtrl",size:"sm"});e.result.then(function(e){a.emit("create-room",JSON.stringify({roomName:e.roomName,playerName:e.playerName}))})},e.$on("socket:room-creation-success",function(e,o){r.url("/room/"+o)}),e.$on("socket:update-mus",function(r,o){e.updateModel(JSON.parse(o))}),e.updateModel=function(r){e.musModel=r},e.joinRoom=function(e){r.url("/room/"+e)},e.roomSize=function(e){return e.game.players.filter(function(e){return null!==e}).length},e.isRoomFull=function(e){return 4===e.game.players.filter(function(e){return null!==e}).length},e.getFullRooms=function(){var r=[];if("undefined"!=typeof e.musModel.roomsModel)for(var o in e.musModel.roomsModel.rooms)e.isRoomFull(e.musModel.roomsModel.rooms[o])&&r.push(e.musModel.roomsModel.rooms[o]);return r},e.getNotFullRooms=function(){var r=[];if("undefined"!=typeof e.musModel.roomsModel)for(var o in e.musModel.roomsModel.rooms)e.isRoomFull(e.musModel.roomsModel.rooms[o])||r.push(e.musModel.roomsModel.rooms[o]);return r},e.getPlayerIndexClass=function(e,r){return"undefined"!=typeof r?"avatar--mini--"+r.indexOf(e):""}}])}(),function(){"use strict";angular.module("musApp").controller("roomCtrl",["$scope","$location","$routeParams","$modal","musSocketService",function(e,r,o,a,t){e.playerName="",e.room={game:{currentStatus:"waiting"}},t.emit("room-info",o.roomId),e.$on("socket:room-info-success",function(o,n){if(e.updateRoom(JSON.parse(n).room),e.playerName=JSON.parse(n).playerName,e.isRoomFull())a.open({animation:!0,templateUrl:"src/views/modals/infoModal.html",controller:"infoModalCtrl",size:"sm",resolve:{infoData:function(){return{title:"Mesa llena",message:"Lo sentimos pero esta mesa está llena. Prueba en otra!"}}}}),r.url("/");else if(!e.isUserInRoomAlready()){var s=a.open({animation:!0,templateUrl:"src/views/modals/joinRoomModal.html",controller:"joinRoomModalCtrl",size:"sm"});s.result.then(function(r){t.emit("join-room",r.playerName,e.room.id)},function(){r.url("/")})}}),e.$on("socket:room-join-success",function(r,o){var a=JSON.parse(o).playerName;e.playerName=a}),e.$on("socket:room-info-failure",function(){a.open({animation:!0,templateUrl:"src/views/modals/infoModal.html",controller:"infoModalCtrl",size:"sm",resolve:{infoData:function(){return{title:"Mesa no válida",message:"La mesa a la que estas intentando acceder no existe. Prueba en otra!"}}}}),r.url("/")}),e.$on("socket:room-join-failure",function(){a.open({animation:!0,templateUrl:"src/views/modals/infoModal.html",controller:"infoModalCtrl",size:"sm",resolve:{infoData:function(){return{title:"Error al unirse a la mesa",message:"Lo sentimos. Hubo un error al acceder a la mesa. Pruebe en otra!"}}}}),r.url("/")}),e.$on("socket:leave-room-success",function(){r.url("/")}),e.$on("socket:update-room",function(r,o){e.$apply(function(){e.updateRoom(JSON.parse(o))})}),e.updateRoom=function(r){var o=e.room.game.currentStatus;e.room=r,e.room.game.currentStatus=o},e.isRoomFull=function(){return e.room.game.players.filter(function(e){return null!==e}).length===e.room.game.maxPlayers},e.isUserInRoomAlready=function(){return e.room.game.players.indexOf(e.playerName)>-1},e.leaveRoom=function(){t.emit("leave-room",e.room.id)}}])}(),function(){"use strict";angular.module("musApp").directive("avatar",function(){return{restrict:"E",replace:!0,templateUrl:"src/views/templates/avatar.html",scope:{playerName:"@",players:"="},link:function(e,r){e.$watch("playerName",function(o){for(var a="",t=0;t<r[0].classList.length;t++){var n=r[0].classList[t];0===n.indexOf("avatar__player--")&&r.removeClass(n)}a="undefined"!=typeof e.players&&null!==o&&""!==o?"avatar__player--"+e.players.indexOf(o):"avatar__player--null",r.addClass(a),r.find("strong").text(e.playerName)})}}})}(),function(){"use strict";angular.module("musApp").directive("chat",function(){return{restrict:"E",replace:!0,templateUrl:"src/views/templates/chat.html",scope:{playerName:"=",players:"="},controller:"chatCtrl"}})}(),function(){"use strict";angular.module("musApp").directive("gameActions",function(){return{restrict:"E",replace:!0,templateUrl:"src/views/templates/game-actions.html",scope:{game:"=",playerName:"="},controller:"gameActionsCtrl"}})}(),function(){"use strict";angular.module("musApp").directive("game",function(){return{restrict:"E",replace:!0,scope:{playerName:"=",room:"="},templateUrl:"src/views/templates/game.html",controller:["$scope","playerLocatorService",function(e,r){e.getPlayer=function(o){return r.locatePlayer(e.room.game,e.playerName,o)}}]}})}(),function(){"use strict";angular.module("musApp").directive("gameTable",["$timeout","cardManagerService","playerLocatorService",function(e,r,o){return{restrict:"E",replace:!0,scope:{playerName:"=",room:"="},templateUrl:"src/views/templates/game-table.html",controller:["$scope",function(e){e.getPlayer=function(r){return o.locatePlayer(e.room.game,e.playerName,r)}}],link:function(o,a){function t(){return o.room.game.players.filter(function(e){return null!==e}).length===o.room.game.maxPlayers}function n(e,r){for(var o=[],a=0;a<e.classList.length;a++){var t=e.classList[a];"card--front"!==t&&"card--back"!==t&&(r&&0===t.indexOf("card--")||0===t.indexOf("card__"))&&o.push(t)}o.forEach(function(r){e.classList.remove(r)})}function s(e){var r=e.querySelector(".card--front"),o=e.querySelector(".card--back");n(r,!0),n(o,!0),e.classList.remove("card--flip")}function i(){for(var e=0;e<o.room.game.maxPlayers;e++)for(var r=a[0].querySelector("#player"+e+"-cards").children,t=0;t<r.length;t++)s(r[t])}function c(e,r,o){e.classList.add("card__animation--in--player"+r),e.classList.add("card__order"+o),e.classList.add("card--reverse")}function l(r,o,a){r.classList.add("card__animation--out--player"+o),r.classList.add("card__order"+a),e(function(){n(r,!0)},a*p+g)}function u(r,o,a,t,s){var i=r[o],l=i.querySelector(".card--front"),u=i.querySelector(".card--back");c(u,a,t),e(function(){s.cardsFlip[a][o]&&(l.classList.add("card--"+s.cardsTranslation[a][o]),i.classList.toggle("card--flip")),n(u,!1)},t*p+g)}function m(r,o,a,t,s){var i=r[o],c=i.querySelector(".card--front"),u=i.querySelector(".card--back");s.cardsFlip[a][o]?(i.classList.toggle("card--flip"),e(function(){n(c,!0),l(u,a,t)},t*y)):l(u,a,t)}function f(e,r,o,a,t){var n=e[r],s=n.querySelector(".card--front");t.cardsFlip[o][r]&&(s.classList.add("card--"+t.cardsTranslation[o][r]),n.classList.toggle("card--flip"))}function d(e,r){var o=e.cardsOrder;o.forEach(function(o,t){var n=a[0].querySelector("#player"+t+"-cards").children;o.forEach(function(o,a){o>0&&r(n,a,t,o,e)})})}var p=200,y=600,g=500;o.$watch("room.game.cards",function(e,a){if("undefined"!=typeof e&&"undefined"!=typeof a&&"undefined"!=typeof o.playerName&&""!==o.playerName)if(t()){var n=r.manageCards(a,e,o.room.game,o.playerName);switch(n.action){case"deal":d(n,u);break;case"discard":d(n,m);break;case"show":d(n,f)}}else i()})}}}])}(),function(){"use strict";angular.module("musApp").directive("message",function(){return{restrict:"E",replace:!0,templateUrl:"src/views/templates/message.html",scope:{playerName:"=",message:"=",players:"="},controller:["$scope",function(e){e.getPlayerIndexClass=function(){return e.players.indexOf(e.message.playerName)===-1?"message__player--room":"message__player--"+e.players.indexOf(e.message.playerName)}}]}})}(),function(){"use strict";angular.module("musApp").directive("spinner",function(){return{restrict:"E",replace:!0,template:'<div class="spinner"><div class="bounce1"></div><div class="bounce2"></div><div class="bounce3"></div></div>'}})}(),function(){"use strict";angular.module("musApp").filter("withoutNull",function(){return function(e){var r=[];return e.forEach(function(e){null!==e&&r.push(e)}),r}})}(),function(){"use strict";angular.module("musApp").factory("musSocketService",function(e){var r=e();return r.forward("update-mus"),r.forward("update-room"),r.forward("room-creation-success"),r.forward("room-info-success"),r.forward("room-info-failure"),r.forward("room-join-failure"),r.forward("room-join-success"),r.forward("new-player-joined"),r.forward("leave-room-success"),r.forward("player-left"),r.forward("game-started"),r.forward("hand-started"),r.forward("new-message"),r})}(),function(){"use strict";angular.module("musApp").config(["$routeProvider",function(e){e.when("/",{templateUrl:"src/views/main.html",controller:"mainCtrl"}).when("/room/:roomId",{templateUrl:"src/views/room.html",controller:"roomCtrl"}).otherwise({redirectTo:"/"})}])}(),function(){"use strict";angular.module("musApp").controller("createRoomModalCtrl",["$scope","$modalInstance",function(e,r){e.roomName="",e.playerName="",e.nothingSubmittedYet=!0,e.roomNameIsMissing=function(){return!e.nothingSubmittedYet&&("undefined"==typeof e.roomName||""===e.roomName)},e.playerNameIsMissing=function(){return!e.nothingSubmittedYet&&("undefined"==typeof e.playerName||""===e.playerName)},e.ok=function(){e.nothingSubmittedYet=!1,e.roomNameIsMissing()||e.playerNameIsMissing()||r.close({roomName:e.roomName,playerName:e.playerName})},e.cancel=function(){r.dismiss("cancel")}}])}(),function(){"use strict";angular.module("musApp").controller("infoModalCtrl",["$scope","$modalInstance","infoData",function(e,r,o){e.infoData=o,e.ok=function(){r.close()}}])}(),function(){"use strict";angular.module("musApp").controller("joinRoomModalCtrl",["$scope","$modalInstance",function(e,r){e.playerName="",e.nothingSubmittedYet=!0,e.playerNameIsMissing=function(){return!e.nothingSubmittedYet&&("undefined"==typeof e.playerName||""===e.playerName)},e.ok=function(){e.nothingSubmittedYet=!1,e.playerNameIsMissing()||r.close({playerName:e.playerName})},e.cancel=function(){r.dismiss("cancel")}}])}(),function(){"use strict";angular.module("musApp").factory("cardManagerService",["arrayShifterService","cardOrderService","cardTranslatorService",function(e,r,o){function a(e,r){var o=[];return e.forEach(function(e,a){e.sort().join(",")!==r[a].sort().join(",")&&o.push(a)}),o}function t(e){switch(e){case 4:return"deal";case 1:return"discard";case 3:return"show"}}function n(e,r){var o=[[!1,!1,!1,!1],[!1,!1,!1,!1],[!1,!1,!1,!1],[!1,!1,!1,!1]];switch(e){case"deal":o[0]=[!0,!0,!0,!0];break;case"discard":0===r[0]&&(o[0]=[!0,!0,!0,!0]);break;case"show":o[1]=[!0,!0,!0,!0],o[2]=[!0,!0,!0,!0],o[3]=[!0,!0,!0,!0]}return o}function s(s,i,c,l){var u,m,f,d,p,y=c.players.indexOf(l),g=e.shiftArrayNPositionsOnDirection(s,y,"left"),h=e.shiftArrayNPositionsOnDirection(i,y,"left");return u=a(g,h),m=t(u.length),f=r.getCardsOrder(g,h,c,l,m,u),d=n(m,u),p=o.getCardsTranslation(h),{action:m,cardsOrder:f,cardsFlip:d,cardsTranslation:p}}return{manageCards:s}}])}(),function(){"use strict";angular.module("musApp").factory("cardOrderService",["arrayShifterService",function(e){function r(e,r){return(e.maxPlayers-e.players.indexOf(r)+e.hand)%e.maxPlayers}function o(e,r){for(var o=0,a=0,t=!0;o<4&&t;){var n=e[o],s=r[o];for(a=0;a<n.length&&t;)n[a]!==s[a]?a++:t=!1;o++}return t}function a(e,r){var o=e[r].filter(function(e){return e>0}).reverse();e[r].forEach(function(a,t){a>0&&(e[r][t]=o.shift())})}function t(t,n,s,i){var c=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],l=r(s,i),u=1;if(e.shiftArrayNPositionsOnDirection(t,l,"left"),e.shiftArrayNPositionsOnDirection(n,l,"left"),o(t,n))for(var m=0;m<4;m++)for(var f=0;f<t.length;f++)c[f][m]=u,u++;else t.forEach(function(e,r){e.forEach(function(e,o){n[r][o]!==e&&(c[r][o]=u,u++)})});return e.shiftArrayNPositionsOnDirection(t,l,"right"),e.shiftArrayNPositionsOnDirection(n,l,"right"),e.shiftArrayNPositionsOnDirection(c,l,"right"),a(c,1),a(c,2),c}function n(e,r,o){var a=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],t=o[0];return e[t].forEach(function(e,o){r[t][o]!==e&&(a[t][o]=1)}),a}function s(){return[[0,0,0,0],[1,1,1,1],[1,1,1,1],[1,1,1,1]]}function i(e,r,o,a,i,c){switch(i){case"deal":return t(e,r,o,a);case"discard":return n(e,r,c);case"show":return s()}}return{getCardsOrder:i}}])}(),function(){"use strict";angular.module("musApp").factory("cardTranslatorService",function(){function e(e){switch(e){case 0:return"o";case 1:return"c";case 2:return"e";case 3:return"b"}}function r(r){switch(r){case-1:return"";case 0:return"reverse";default:var o=r%10,a=Math.floor(r/10);return 0===o&&(o=10,a-=1),e(a)+o}}function o(e){var o=[];return e.forEach(function(e,a){o.push([]),e.forEach(function(e){o[a].push(r(e))})}),o}return{getCardsTranslation:o}})}(),function(){"use strict";angular.module("musApp").factory("playerLocatorService",function(){function e(e,r,o){if("undefined"!=typeof e&&"undefined"!=typeof e.players){var a,t=e.players.indexOf(r);if(t>-1)return a=(t+o)%e.maxPlayers,e.players[a]}return null}return{locatePlayer:e}})}(),function(){"use strict";angular.module("musApp").factory("arrayShifterService",function(){function e(e,r,o){var a,t=e;if(e.length<=1)return e;if("right"===o)for(a=0;a<r;a++)t.unshift(t.pop());if("left"===o)for(a=0;a<r;a++)t.push(t.shift());return t}return{shiftArrayNPositionsOnDirection:e}})}();