!function(){"use strict";angular.module("musApp",["ngRoute","ngAnimate","btford.socket-io","ui.bootstrap"])}(),function(){"use strict";angular.module("musApp").controller("chatCtrl",["$scope","$element","$filter","musSocketService",function(e,r,o,t){e.chatLog=[],e.message="",e.$on("socket:room-join-success",function(r,o){var t=JSON.parse(o).room.name,a=JSON.parse(o).playerName;e.updateLog(t,"¡Bienvenido a "+t+" "+a+"!")}),e.$on("socket:new-message",function(r,o){e.updateLog(JSON.parse(o).playerName,JSON.parse(o).message)}),e.$on("socket:new-player-joined",function(r,o){var t=JSON.parse(o).room.name,a=JSON.parse(o).playerName;e.updateLog(t,a+" se ha unido a "+t+".")}),e.$on("socket:player-left",function(r,o){var t=JSON.parse(o).room.name,a=JSON.parse(o).playerName;e.updateLog(t,a+" ha abandonado "+t+".")}),e.$watchCollection("chatLog",function(){e.$evalAsync(function(){var e=r[0].getElementsByClassName("chat__panel")[0];e.scrollTop=e.scrollHeight})}),e.updateLog=function(r,o){e.chatLog.push({playerName:r,time:new Date,content:o})},e.sendMessage=function(){t.emit("message",e.message),e.message=""}}])}(),function(){"use strict";angular.module("musApp").controller("gameActionsCtrl",["$scope","musSocketService",function(e,r){console.log(r),e.$on("socket:game-started",function(){e.game.currentStatus="game-started"}),e.$on("socket:player-left",function(){e.game.currentStatus="waiting"}),e.$on("socket:hand-started",function(r,o){var t=JSON.parse(o),a=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]];e.game.currentStatus="hand-started",e.game.players.forEach(function(r,o){e.playerName===r&&(a[o]=t)}),e.game.cards=a}),e.isRoomFull=function(){return e.game.players.filter(function(e){return null!==e}).length===e.game.maxPlayers}}])}(),function(){"use strict";angular.module("musApp").controller("mainCtrl",["$scope","$location","$modal","musSocketService",function(e,r,o,t){e.musModel={},t.emit("mus-info"),e.createRoom=function(){var e=o.open({animation:!0,templateUrl:"src/views/modals/createRoomModal.html",controller:"createRoomModalCtrl",size:"sm"});e.result.then(function(e){t.emit("create-room",JSON.stringify({roomName:e.roomName,playerName:e.playerName}))})},e.$on("socket:room-creation-success",function(e,o){r.url("/room/"+o)}),e.$on("socket:update-mus",function(r,o){e.updateModel(JSON.parse(o))}),e.updateModel=function(r){e.musModel=r},e.joinRoom=function(e){r.url("/room/"+e)},e.roomSize=function(e){return e.game.players.filter(function(e){return null!==e}).length},e.isRoomFull=function(e){return 4===e.game.players.filter(function(e){return null!==e}).length},e.getFullRooms=function(){var r=[];if("undefined"!=typeof e.musModel.roomsModel)for(var o in e.musModel.roomsModel.rooms)e.isRoomFull(e.musModel.roomsModel.rooms[o])&&r.push(e.musModel.roomsModel.rooms[o]);return r},e.getNotFullRooms=function(){var r=[];if("undefined"!=typeof e.musModel.roomsModel)for(var o in e.musModel.roomsModel.rooms)e.isRoomFull(e.musModel.roomsModel.rooms[o])||r.push(e.musModel.roomsModel.rooms[o]);return r},e.getPlayerIndexClass=function(e,r){return"undefined"!=typeof r?"avatar--mini--"+r.indexOf(e):""}}])}(),function(){"use strict";angular.module("musApp").controller("roomCtrl",["$scope","$location","$routeParams","$modal","musSocketService",function(e,r,o,t,a){e.playerName="",e.room={game:{currentStatus:"waiting"}},a.emit("room-info",o.roomId),e.$on("socket:room-info-success",function(o,n){if(e.updateRoom(JSON.parse(n).room),e.playerName=JSON.parse(n).playerName,e.isRoomFull())t.open({animation:!0,templateUrl:"src/views/modals/infoModal.html",controller:"infoModalCtrl",size:"sm",resolve:{infoData:function(){return{title:"Mesa llena",message:"Lo sentimos pero esta mesa está llena. Prueba en otra!"}}}}),r.url("/");else if(!e.isUserInRoomAlready()){var s=t.open({animation:!0,templateUrl:"src/views/modals/joinRoomModal.html",controller:"joinRoomModalCtrl",size:"sm"});s.result.then(function(r){a.emit("join-room",r.playerName,e.room.id)},function(){r.url("/")})}}),e.$on("socket:room-join-success",function(r,o){var t=JSON.parse(o).playerName;e.playerName=t}),e.$on("socket:room-info-failure",function(){t.open({animation:!0,templateUrl:"src/views/modals/infoModal.html",controller:"infoModalCtrl",size:"sm",resolve:{infoData:function(){return{title:"Mesa no válida",message:"La mesa a la que estas intentando acceder no existe. Prueba en otra!"}}}}),r.url("/")}),e.$on("socket:room-join-failure",function(){t.open({animation:!0,templateUrl:"src/views/modals/infoModal.html",controller:"infoModalCtrl",size:"sm",resolve:{infoData:function(){return{title:"Error al unirse a la mesa",message:"Lo sentimos. Hubo un error al acceder a la mesa. Pruebe en otra!"}}}}),r.url("/")}),e.$on("socket:leave-room-success",function(){r.url("/")}),e.$on("socket:update-room",function(r,o){e.$apply(function(){e.updateRoom(JSON.parse(o))})}),e.updateRoom=function(r){var o=e.room.game.currentStatus;e.room=r,e.room.game.currentStatus=o},e.isRoomFull=function(){return e.room.game.players.filter(function(e){return null!==e}).length===e.room.game.maxPlayers},e.isUserInRoomAlready=function(){return e.room.game.players.indexOf(e.playerName)>-1},e.leaveRoom=function(){a.emit("leave-room",e.room.id)}}])}(),function(){"use strict";angular.module("musApp").directive("avatar",function(){return{restrict:"E",replace:!0,templateUrl:"src/views/templates/avatar.html",scope:{playerName:"@",players:"="},link:function(e,r){e.$watch("playerName",function(o){for(var t="",a=0;a<r[0].classList.length;a++){var n=r[0].classList[a];0===n.indexOf("avatar__player--")&&r.removeClass(n)}t="undefined"!=typeof e.players&&null!==o&&""!==o?"avatar__player--"+e.players.indexOf(o):"avatar__player--null",r.addClass(t),r.find("strong").text(e.playerName)})}}})}(),function(){"use strict";angular.module("musApp").directive("chat",function(){return{restrict:"E",replace:!0,templateUrl:"src/views/templates/chat.html",scope:{playerName:"=",players:"="},controller:"chatCtrl"}})}(),function(){"use strict";angular.module("musApp").directive("gameActions",function(){return{restrict:"E",replace:!0,templateUrl:"src/views/templates/game-actions.html",scope:{game:"=",playerName:"="},controller:"gameActionsCtrl"}})}(),function(){"use strict";angular.module("musApp").directive("game",function(){return{restrict:"E",replace:!0,scope:{playerName:"=",room:"="},templateUrl:"src/views/templates/game.html",controller:["$scope","playerLocatorService",function(e,r){e.getPlayer=function(o){return r.locatePlayer(e.room.game,e.playerName,o)}}]}})}(),function(){"use strict";angular.module("musApp").directive("gameTable",["cardDealingOrderService","playerLocatorService","cardTranslatorService",function(e,r,o){return{restrict:"E",replace:!0,scope:{playerName:"=",room:"="},templateUrl:"src/views/templates/game-table.html",controller:["$scope",function(e){e.getPlayer=function(o){return r.locatePlayer(e.room.game,e.playerName,o)}}],link:function(t,a){function n(e,r){for(var o=[],t=0;t<e[r].classList.length;t++){var a=e[r].classList[t];(0===a.indexOf("card--")||0===a.indexOf("card__"))&&o.push(a)}o.forEach(function(o){e[r].classList.remove(o)})}function s(e,r,a,n,s){"waiting"!==t.room.game.currentStatus&&e[r].classList.add("card__order"+a);var i=t.room.game.cards[s][r]>-1?"in":"out";"waiting"!==t.room.game.currentStatus&&e[r].classList.add("card__animation--"+i+"--player"+n),e[r].classList.add("card--"+o.translateCard(t.room.game.cards[s][r]))}t.$watch("room.game.cards",function(o,i){if("undefined"!=typeof o&&"undefined"!=typeof i&&"undefined"!=typeof t.playerName&&""!==t.playerName)for(var l=e.getDealingOrder(i,o,t.room.game,t.playerName),c=0;c<t.room.game.maxPlayers;c++){var u=r.locatePlayer(t.room.game,t.playerName,c),m=t.room.game.players.indexOf(u),f=l[m],d=a[0].querySelector("#player"+c+"-cards").children;f.forEach(function(e,r){0!==e&&(n(d,r),s(d,r,e,c,m))})}})}}}])}(),function(){"use strict";angular.module("musApp").directive("message",function(){return{restrict:"E",replace:!0,templateUrl:"src/views/templates/message.html",scope:{playerName:"=",message:"=",players:"="},controller:["$scope",function(e){e.getPlayerIndexClass=function(){return-1===e.players.indexOf(e.message.playerName)?"message__player--room":"message__player--"+e.players.indexOf(e.message.playerName)}}]}})}(),function(){"use strict";angular.module("musApp").directive("spinner",function(){return{restrict:"E",replace:!0,template:'<div class="spinner"><div class="bounce1"></div><div class="bounce2"></div><div class="bounce3"></div></div>'}})}(),function(){"use strict";angular.module("musApp").filter("withoutNull",function(){return function(e){var r=[];return e.forEach(function(e){null!==e&&r.push(e)}),r}})}(),function(){"use strict";angular.module("musApp").config(["$routeProvider",function(e){e.when("/",{templateUrl:"src/views/main.html",controller:"mainCtrl"}).when("/room/:roomId",{templateUrl:"src/views/room.html",controller:"roomCtrl"}).otherwise({redirectTo:"/"})}])}(),function(){"use strict";angular.module("musApp").factory("musSocketService",function(e){var r=e();return r.forward("update-mus"),r.forward("update-room"),r.forward("room-creation-success"),r.forward("room-info-success"),r.forward("room-info-failure"),r.forward("room-join-failure"),r.forward("room-join-success"),r.forward("new-player-joined"),r.forward("leave-room-success"),r.forward("player-left"),r.forward("game-started"),r.forward("hand-started"),r.forward("new-message"),r})}(),function(){"use strict";angular.module("musApp").controller("createRoomModalCtrl",["$scope","$modalInstance",function(e,r){e.roomName="",e.playerName="",e.nothingSubmittedYet=!0,e.roomNameIsMissing=function(){return!e.nothingSubmittedYet&&("undefined"==typeof e.roomName||""===e.roomName)},e.playerNameIsMissing=function(){return!e.nothingSubmittedYet&&("undefined"==typeof e.playerName||""===e.playerName)},e.ok=function(){e.nothingSubmittedYet=!1,e.roomNameIsMissing()||e.playerNameIsMissing()||r.close({roomName:e.roomName,playerName:e.playerName})},e.cancel=function(){r.dismiss("cancel")}}])}(),function(){"use strict";angular.module("musApp").controller("infoModalCtrl",["$scope","$modalInstance","infoData",function(e,r,o){e.infoData=o,e.ok=function(){r.close()}}])}(),function(){"use strict";angular.module("musApp").controller("joinRoomModalCtrl",["$scope","$modalInstance",function(e,r){e.playerName="",e.nothingSubmittedYet=!0,e.playerNameIsMissing=function(){return!e.nothingSubmittedYet&&("undefined"==typeof e.playerName||""===e.playerName)},e.ok=function(){e.nothingSubmittedYet=!1,e.playerNameIsMissing()||r.close({playerName:e.playerName})},e.cancel=function(){r.dismiss("cancel")}}])}(),function(){"use strict";angular.module("musApp").factory("cardManagerService",["arrayShifterService","cardOrderService","cardTranslatorService",function(e,r,o){function t(e,r){var o=[];return e.forEach(function(e,t){e.sort().join(",")!==r[t].sort().join(",")&&o.push(t)}),o}function a(e){switch(e){case 4:return"deal";case 1:return"discard";case 3:return"show"}}function n(e,r){var o=[[!1,!1,!1,!1],[!1,!1,!1,!1],[!1,!1,!1,!1],[!1,!1,!1,!1]];switch(e){case"deal":o[0]=[!0,!0,!0,!0];break;case"discard":0===r[0]&&(o[0]=[!0,!0,!0,!0]);break;case"show":o[1]=[!0,!0,!0,!0],o[2]=[!0,!0,!0,!0],o[3]=[!0,!0,!0,!0]}return o}function s(s,i,l,c){var u,m,f,d,p,g=l.players.indexOf(c),y=e.shiftArrayNPositionsOnDirection(s,g,"left"),v=e.shiftArrayNPositionsOnDirection(i,g,"left");return u=t(y,v),m=a(u.length),f=r.getCardsOrder(y,v,l,c,m,u),d=n(m,u),p=o.getCardsTranslation(v),{action:m,cardsOrder:f,cardsFlip:d,cardsTranslation:p}}return{manageCards:s}}])}(),function(){"use strict";angular.module("musApp").factory("cardOrderService",["arrayShifterService",function(e){function r(e,r){return(e.maxPlayers-e.players.indexOf(r)+e.hand)%e.maxPlayers}function o(e,r){for(var o=0,t=0,a=!0;4>o&&a;){var n=e[o],s=r[o];for(t=0;t<n.length&&a;)n[t]!==s[t]?t++:a=!1;o++}return a}function t(e,r){var o=e[r].filter(function(e){return e>0}).reverse();e[r].forEach(function(t,a){t>0&&(e[r][a]=o.shift())})}function a(a,n,s,i){var l=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],c=r(s,i),u=1;if(e.shiftArrayNPositionsOnDirection(a,c,"left"),e.shiftArrayNPositionsOnDirection(n,c,"left"),o(a,n))for(var m=0;4>m;m++)for(var f=0;f<a.length;f++)l[f][m]=u,u++;else a.forEach(function(e,r){e.forEach(function(e,o){n[r][o]!==e&&(l[r][o]=u,u++)})});return e.shiftArrayNPositionsOnDirection(a,c,"right"),e.shiftArrayNPositionsOnDirection(n,c,"right"),e.shiftArrayNPositionsOnDirection(l,c,"right"),t(l,1),t(l,2),l}function n(e,r,o){var t=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],a=o[0];return e[a].forEach(function(e,o){r[a][o]!==e&&(t[a][o]=1)}),t}function s(){return[[0,0,0,0],[1,1,1,1],[1,1,1,1],[1,1,1,1]]}function i(e,r,o,t,i,l){switch(i){case"deal":return a(e,r,o,t);case"discard":return n(e,r,l);case"show":return s()}}return{getCardsOrder:i}}])}(),function(){"use strict";angular.module("musApp").factory("cardTranslatorService",function(){function e(e){switch(e){case 0:return"o";case 1:return"c";case 2:return"e";case 3:return"b"}}function r(r){switch(r){case-1:return"";case 0:return"reverse";default:var o=r%10,t=Math.floor(r/10);return 0===o&&(o=10,t-=1),e(t)+o}}function o(e){var o=[];return e.forEach(function(e,t){o.push([]),e.forEach(function(e){o[t].push(r(e))})}),o}return{getCardsTranslation:o}})}(),function(){"use strict";angular.module("musApp").factory("playerLocatorService",function(){function e(e,r,o){if("undefined"!=typeof e&&"undefined"!=typeof e.players){var t=e.players.indexOf(r),a=(t+o)%e.maxPlayers;return e.players[a]}return null}return{locatePlayer:e}})}(),function(){"use strict";angular.module("musApp").factory("arrayShifterService",function(){function e(e,r,o){var t;if("right"===o)for(t=0;r>t;t++)e.unshift(e.pop());if("left"===o)for(t=0;r>t;t++)e.push(e.shift())}return{shiftArrayNPositionsOnDirection:e}})}();